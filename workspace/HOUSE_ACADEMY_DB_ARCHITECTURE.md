# 집/학원 공동운영 DB 아키텍처 (1페이지)

## 목적
집 PC와 학원 PC를 하나의 운영 체계로 묶되,
- 실시간 협업
- 장기 보관
- 의미 기반 기억 검색
- 정형 데이터 무결성
을 동시에 만족한다.

---

## 역할 분담

### 1) Supabase (운영 허브)
- 역할: **실시간 운영 DB + API 게이트웨이**
- 저장: devices, shared_memories, sync_log, conversations
- 강점: 집/학원 노드 동기화, 즉시 조회/쓰기, 대시보드 운영
- 원칙: 앱/워크플로우의 "현재 상태"는 Supabase를 기준으로 본다.

### 2) Google Drive (장기 아카이브)
- 역할: **파일 보관소**
- 저장: 보고서, 원본 문서(pdf/docx/hwp), 결과물(mp4/png), 백업
- 강점: 공유/보관/복구가 쉬움
- 원칙: 최종 산출물은 Drive에 남긴다.

### 3) LanceDB (로컬 의미 기억)
- 역할: **로컬 벡터 메모리**
- 저장: 인사이트, 로그 요약, 유사 문맥 임베딩
- 강점: 빠른 로컬 의미검색(RAG), 긴 문맥 회상
- 원칙: 깊은 검색/오프라인 추론은 LanceDB 우선.

### 4) Upstash Vector (클라우드 단기 기억)
- 역할: **초경량 글로벌 컨텍스트 메모리**
- 저장: 최근 지시, 선호도, 단기 요약
- 강점: 기기 간 공유 속도, 서버리스 운영
- 원칙: "방금 지시/현재 톤/최근 맥락"은 Upstash 우선.

### 5) PostgreSQL (정형 원장)
- 역할: **정형 데이터/무결성/감사 원장**
- 저장: 관계형 레코드, 상태 지표, 감사 로그
- 강점: 트랜잭션, 제약조건, 분석 쿼리
- 원칙: 수치/상태/근거 데이터의 기준 원장은 PostgreSQL.

---

## 표준 데이터 흐름
1. Telegram/요청 수신
2. OpenClaw → Antigravity 실행
3. 작업 중 상태/공유값: Supabase 기록
4. 단기 기억: Upstash 갱신
5. 의미 지식: LanceDB 저장
6. 결과 파일: Google Drive 업로드
7. 정형 로그/지표: PostgreSQL 기록
8. Entire 체크포인트로 변경 이력 보존

---

## 운영 원칙 (간단)
- 실시간 상태: Supabase
- 파일 보관: Drive
- 의미 검색: LanceDB/Upstash
- 정형 기준값: PostgreSQL
- 변경 이력: Entire

---

## 주기 점검 체크리스트
- [ ] Supabase 테이블 접근/권한(RLS) 정상
- [ ] Upstash 읽기/쓰기 지연 없음
- [ ] LanceDB 쿼리 성공률 확인
- [ ] Drive 업로드/링크 권한 확인
- [ ] PostgreSQL 연결/인덱스 점검
- [ ] 키/토큰 만료 상태 점검
